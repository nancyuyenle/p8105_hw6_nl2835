p8105_hw6_nl2835
================
Nancy Le
2023-11-27

## Problem 2

``` r
weather_df = 
  rnoaa::meteo_pull_monitors(
    c("USW00094728"),
    var = c("PRCP", "TMIN", "TMAX"), 
    date_min = "2022-01-01",
    date_max = "2022-12-31") |>
  mutate(
    name = recode(id, USW00094728 = "CentralPark_NY"),
    tmin = tmin / 10,
    tmax = tmax / 10) |>
  select(name, id, everything())
```

``` r
boot_sample = function(weather_df) {
  sample_n(weather_df, size = nrow(weather_df), replace = TRUE)
}
```

``` r
bootstrap_reg <- function(df) {
  regression <- lm(tmax ~tmin + prcp, data = df)
  r2 <- summary(regression)$r.squared
  beta_1 <- coef(regression)["tmin"]
  beta_2 <- coef(regression)["prcp"]
  beta_inter <- beta_1 * beta_2 
  
  if (beta_inter <= 0) {
    logbetainter <- NA } else {
      logbetainter <- log(beta_inter)
    }
  
  tibble(r2 = r2, logbetainter = log(beta_inter))
}

boot_straps <- 
  tibble(strap_number = 1:5000) |> 
  mutate(
    strap_sample = map(strap_number, ~boot_sample(weather_df)), 
    bootstrap_results = map_dfr(strap_sample, ~bootstrap_reg(.x |> as_tibble()))
  )
## Warning: There were 3361 warnings in `mutate()`.
## The first warning was:
## ℹ In argument: `bootstrap_results = map_dfr(strap_sample,
##   ~bootstrap_reg(as_tibble(.x)))`.
## Caused by warning in `log()`:
## ! NaNs produced
## ℹ Run `dplyr::last_dplyr_warnings()` to see the 3360 remaining warnings.
```

``` r
boot_straps
## # A tibble: 5,000 × 3
##    strap_number strap_sample       bootstrap_results$r2 $logbetainter
##           <int> <list>                            <dbl>         <dbl>
##  1            1 <tibble [365 × 6]>                0.898         -5.44
##  2            2 <tibble [365 × 6]>                0.928        NaN   
##  3            3 <tibble [365 × 6]>                0.925        NaN   
##  4            4 <tibble [365 × 6]>                0.931        NaN   
##  5            5 <tibble [365 × 6]>                0.915        NaN   
##  6            6 <tibble [365 × 6]>                0.918         -7.18
##  7            7 <tibble [365 × 6]>                0.922        NaN   
##  8            8 <tibble [365 × 6]>                0.910         -6.65
##  9            9 <tibble [365 × 6]>                0.910         -6.21
## 10           10 <tibble [365 × 6]>                0.939        NaN   
## # ℹ 4,990 more rows
```

``` r
ggplot(boot_straps, aes(x = bootstrap_results$r2)) +
  geom_histogram(binwidth = 0.01, fill = "blue", color = "black") + 
  labs(title = "R-squared Estimates Distribution", 
       x = "R^2",
       y = "Frequency")
```

![](p8105_hw6_nl2835_files/figure-gfm/plot%20estimates%20of%20R2-1.png)<!-- -->

The distribution of r-squared estimates centers around R2 = 0.92 and is
a symmetric distribution.

``` r
ggplot(boot_straps, aes(x = bootstrap_results$logbetainter)) +
  geom_histogram(binwidth = 0.05, fill = "lightgreen", color = "black") + 
  labs(title = "Log Interaction Estimates", 
       x = "log(beta1*beta2)",
       y = "Frequency")
## Warning: Removed 3361 rows containing non-finite values (`stat_bin()`).
```

![](p8105_hw6_nl2835_files/figure-gfm/plot%20estimates%20of%20log(beta%20interecepts)-1.png)<!-- -->

The distribution of log(b0 \* b1) estimates is skewed left, with a
median around -6.

``` r
r_squared_quantiles <- quantile(boot_straps$bootstrap_results$r2, probs = c(0.025, 0.975), na.rm = TRUE)
```

``` r
logbetainter_quantiles <- quantile(boot_straps$bootstrap_results$logbetainter, probs = c(0.025, 0.975), na.rm = TRUE)
```

``` r
r_squared_quantiles
##      2.5%     97.5% 
## 0.8885495 0.9406812
logbetainter_quantiles
##      2.5%     97.5% 
## -8.981559 -4.601673
```
